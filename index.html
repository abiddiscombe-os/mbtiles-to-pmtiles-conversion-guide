<!DOCTYPE html>
<html lang='en' dir='ltr'>

    <head>
        <title>OS Open Zoomstack PMTiles Demo</title>
        <meta charset='utf-8'>
        <meta name='viewport' content='width=device-width, initial-scale=1.0'>
        <meta name='author' content='https://github.com/abiddiscombe-os'>

        <!-- maplibre-gl-js -->
        <link rel='stylesheet' href='https://unpkg.com/maplibre-gl@2.2.0-pre.2/dist/maplibre-gl.css' />
        <script src='https://unpkg.com/maplibre-gl@2.2.0-pre.2/dist/maplibre-gl.js'></script>

        <!-- pmtiles-plugin -->
        <script src='https://unpkg.com/pmtiles@1.0.4/dist/index.js'></script>

        <!-- tailwind (via twind.style) -->
	    <!script src='https://cdn.twind.style' crossorigin></script>
        <script src="https://cdn.tailwindcss.com"></script>

    </head>

    <body class='h-screen grid grid-rows-[auto,auto,auto,1fr]'>
        <ribbon class='px-4 py-2 bg-gray-800'>
            <img class='h-4' src='https://labs.os.uk/static/media/os-logo-white.svg' />
        </ribbon>
        <header class='px-4 py-3 bg-white flex justify-between border-b border-gray-200'>
            <h1 class='text-lg text-gray-800 font-semibold'>
                Zoomstack PMTiles Demo
            </h1>
            <button class='text-xs text-white px-4 py-1 rounded-2xl bg-[#453c90] hover:bg-[#373073] hover:shadow' onclick='navigateToSource()'>
                View Source
            </button>
        </header>
        <nav class="px-4 py-2 bg-gray-50 flex gap-2 border-b border-gray-200">
            <!-- note: button styles are defined within js -->
            <button id='js-btn-0' onclick='changeStyle(0)'>Light</button>
            <button id='js-btn-1' onclick='changeStyle(1)'>Night</button>
            <button id='js-btn-2' onclick='changeStyle(2)'>Outdoor</button>
            <button id='js-btn-3' onclick='changeStyle(3)'>Road</button>
        </nav>
        <div class='h-full' id='map'>
            <noscript>
                <p>JavaScript is required to use MapLibre.</p>
            </noscript>
         </div>
     </body>
    
    <script>

        const styles = [
            'https://labs.os.uk/pmtiles/styles/open-zoomstack/light.json',
            'https://labs.os.uk/pmtiles/styles/open-zoomstack/night.json',
            'https://labs.os.uk/pmtiles/styles/open-zoomstack/outdoor.json',
            'https://labs.os.uk/pmtiles/styles/open-zoomstack/road.json',
        ]

        function navigateToSource() {
            document.location.href = 'https://github.com/abiddiscombe-os/os-zoomstack2pmtiles'
        }

        function changeStyle(newStyle) {
            map.setStyle(styles[newStyle])
            document.getElementById('js-btn-0').className = 'grow md:grow-0 text-sm text-gray-800 px-4 md:px-6 py-1 rounded border border-gray-200 bg-white hover:bg-gray-100';
            document.getElementById('js-btn-1').className = 'grow md:grow-0 text-sm text-gray-800 px-4 md:px-6 py-1 rounded border border-gray-200 bg-white hover:bg-gray-100';
            document.getElementById('js-btn-2').className = 'grow md:grow-0 text-sm text-gray-800 px-4 md:px-6 py-1 rounded border border-gray-200 bg-white hover:bg-gray-100';
            document.getElementById('js-btn-3').className = 'grow md:grow-0 text-sm text-gray-800 px-4 md:px-6 py-1 rounded border border-gray-200 bg-white hover:bg-gray-100';
            document.getElementById(`js-btn-${newStyle}`).className = 'grow md:grow-0 text-sm text-white px-4 md:px-6 py-1 rounded border border-[#d40058] bg-[#d40058]';
        }

        maplibregl.addProtocol('pmtiles', new pmtiles.ProtocolCache().protocol);

        const map = new maplibregl.Map({
            container: 'map',
            style: 'https://labs.os.uk/pmtiles/styles/open-zoomstack/light.json',
            center: [-2.9626, 54.4301],
            zoom: 12,
            maxZoom: 14,
            minZoom: 5,
            dragRotate: false
        });

        map.on('load', () => {

            map.addControl(new maplibregl.NavigationControl({
                showCompass: false,
            }), 'top-right')

        })

        // init map style
        changeStyle(0)

    </script>
    

</html>